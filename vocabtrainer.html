<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JaponÃ©s Interactivo: MenÃº y ConversaciÃ³n</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados y fuente Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&family=Inconsolata:wght@700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
            min-height: 100vh;
        }

        /* --- Sidenav Styles --- */
        #sidenav {
            height: 100%;
            width: 0; /* Cerrado por defecto */
            position: fixed;
            z-index: 100;
            top: 0;
            left: 0;
            background-color: rgba(255, 255, 255, 0.98);
            overflow-x: hidden;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: 60px;
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.3);
        }
        
        #sidenav.open {
            width: 300px; /* Ancho abierto */
        }
        @media (max-width: 640px) {
            #sidenav.open {
                width: 80%; /* MÃ¡s ancho en mÃ³vil */
            }
        }
        .sidenav-item {
            transition: background-color 0.2s;
        }
        .sidenav-item:hover {
            background-color: #eff6ff; /* blue-50 */
        }
        
        /* --- Blur Overlay and Main Content Effect --- */
        #main-content {
            transition: filter 0.5s;
        }
        .blurry {
            filter: blur(5px);
            pointer-events: none; /* Deshabilita clicks en el fondo */
        }

        /* --- AnimaciÃ³n de Manga para Globos de Texto --- */
        @keyframes mangaPop {
            0% { transform: scale(0.9); opacity: 0; filter: drop-shadow(0 0 0 rgba(0,0,0,0)); }
            100% { transform: scale(1); opacity: 1; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        }
        .manga-bubble-animated {
            animation: mangaPop 0.3s ease-out forwards;
            opacity: 0; /* Oculto inicialmente */
        }

        /* --- Colores y TransiciÃ³n de Nivel --- */
        .level-card {
            transition: background-color 0.5s ease-in-out, border-color 0.5s ease-in-out;
            border-width: 4px;
        }
        /* Colores Base */
        .facil-color { background-color: #ecfdf5; border-color: #34d399; }
        .medio-color { background-color: #fffbeb; border-color: #fcd34d; }
        .dificil-color { background-color: #fef2f2; border-color: #f87171; }
        /* Texto de Nivel */
        .facil-text { color: #059669; }
        .medio-text { color: #d97706; }
        .dificil-text { color: #ef4444; }
        
        /* --- Estilo del Tooltip de Duolingo --- */
        #tooltip {
            position: fixed; 
            background-color: #374151; /* Gray-700 */
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            z-index: 200; 
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            font-family: 'Noto Sans JP', sans-serif;
            min-width: 150px;
        }
        #tooltip.visible { opacity: 1; }
        #tooltip::before {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; 
            border-top: 8px solid #374151;
        }
        .japanese-word {
            display: inline-block; cursor: pointer; padding: 0 1px; 
            border-bottom: 2px dotted rgba(59, 130, 246, 0.5);
        }
        .japanese-word:hover {
            background-color: rgba(59, 130, 246, 0.1); 
            border-radius: 4px;
        }

        /* --- FOOTER: Typewriter Animation --- */
        .typewriter-text-container {
            border-right: .15em solid #f97316; /* Cursor Naranja */
            overflow: hidden; 
            white-space: nowrap; 
            margin: 0 auto; 
            letter-spacing: .15em; 
            animation: 
                typing 3s steps(40, end),
                blink-caret .75s step-end infinite;
            font-family: 'Inconsolata', monospace;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #f97316; }
        }

        /* --- FOOTER: Neon Button Style --- */
        .neon-button {
            text-shadow: 0 0 5px #0ff, 0 0 10px #0ff, 0 0 20px #0ff;
            box-shadow: 0 0 5px #0ff, 0 0 20px #0ff;
            transition: all 0.3s ease;
        }
        .neon-button:hover {
            color: #fff;
            background-color: #0ea5e9; /* Sky-600 */
            box-shadow: 0 0 10px #0ea5e9, 0 0 30px #0ea5e9, 0 0 60px #0ea5e9;
        }

    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Tooltip (Duolingo Style) -->
    <div id="tooltip" class="text-sm">
        <div id="tooltip-content"></div>
    </div>

    <!-- SIDE NAV (MENÃš LATERAL DESPLEGABLE) -->
    <div id="sidenav" class="p-4 flex flex-col">
        <button id="close-sidenav-btn" class="absolute top-4 right-4 text-3xl text-gray-700 hover:text-red-500 font-bold leading-none">&times;</button>
        <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ğŸ“‚ MenÃº de DiÃ¡logos</h3>
        
        <!-- Contenedor para el menÃº por contexto -->
        <div id="sidenav-content" class="space-y-3 overflow-y-auto">
            <!-- Items de navegaciÃ³n irÃ¡n aquÃ­ -->
        </div>
    </div>

    <!-- MAIN CONTENT WRAPPER -->
    <div id="main-content" class="w-full flex-grow flex justify-center py-8">
        <div id="app" class="w-full max-w-4xl mx-auto shadow-2xl rounded-2xl p-6 md:p-8 level-card facil-color">
            
            <!-- HEADER Y CONTROL DE NAVEGACIÃ“N -->
            <header class="mb-6 flex flex-col sm:flex-row justify-between items-center relative">
                <button id="open-sidenav-btn" class="bg-blue-600 text-white p-2 rounded-lg shadow-lg hover:bg-blue-700 transition order-2 sm:order-1 mb-4 sm:mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                    MenÃº Contextual
                </button>
                
                <div class="text-center order-1 sm:order-2 flex-grow">
                    <h1 id="dialog-title" class="text-2xl font-extrabold text-gray-800">DiÃ¡logo de PrÃ¡ctica</h1>
                </div>

                <!-- Contenedor de InformaciÃ³n de Nivel -->
                <div id="levelDisplay" class="px-4 py-1 rounded-full font-bold facil-color border-2 facil-text shadow-sm order-3">
                    Nivel: FÃ¡cil
                </div>
            </header>

            <!-- Ãrea de ConversaciÃ³n y Dificultad -->
            <div id="dialog-content-area" class="bg-white p-4 rounded-xl shadow-inner border border-gray-200">
                
                <!-- Selector de Dificultad (para re-renderizar la visibilidad de Romaji/EspaÃ±ol) -->
                <div class="flex items-center justify-end mb-4 p-2 bg-gray-50 rounded-lg">
                    <label for="difficulty-selector" class="text-sm font-medium text-gray-700 whitespace-nowrap mr-2">TraducciÃ³n:</label>
                    <select id="difficulty-selector" class="p-1 border border-gray-300 rounded-lg shadow-sm bg-white text-gray-800 text-sm font-semibold">
                        <option value="easy">FÃ¡cil (JP + Romaji + ES)</option>
                        <option value="medium" selected>Medio (JP + ES)</option>
                        <option value="hard">DifÃ­cil (Solo JP)</option>
                    </select>
                </div>
                
                <!-- Contenedor de la conversaciÃ³n -->
                <div id="conversation-log" class="space-y-4 overflow-y-auto max-h-80 p-2">
                    <!-- Las lÃ­neas del diÃ¡logo aparecerÃ¡n aquÃ­ -->
                    <div id="initial-message" class="text-gray-500 text-center p-4">
                        Selecciona un diÃ¡logo del **MenÃº Contextual** para empezar.
                    </div>
                </div>
            </div>
            
            <!-- Controles y TraducciÃ³n -->
            <div class="mt-6 flex flex-col sm:flex-row justify-between items-center gap-4">
                
                <p id="status-message" class="text-sm text-gray-500 font-medium"></p>
                
                <div class="flex gap-3 w-full sm:w-auto justify-end">
                    <button id="reset-dialog-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-150 shadow-md disabled:opacity-50">
                        Reiniciar
                    </button>
                    <button id="next-line-btn" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-xl hover:bg-indigo-700 transition duration-150 shadow-lg" disabled>
                        Siguiente LÃ­nea
                    </button>
                </div>
            </div>

        </div>
    </div>
    
    <!-- FOOTER DINÃMICO -->
    <footer class="w-full py-6 bg-gray-800 text-white mt-8 shadow-inner border-t-4 border-indigo-600">
        <div class="max-w-4xl mx-auto flex flex-col items-center">
            
            <!-- Typewriter Display -->
            <div id="typewriter-container" class="text-center mb-4 h-8 flex justify-center items-center">
                <h2 id="typewriter-text" class="text-xl md:text-2xl font-bold text-orange-400"></h2>
            </div>
            
            <!-- Neon Button -->
            <a href="https://www.instagram.com/zvacademy_vzla" target="_blank" 
               class="neon-button text-white bg-blue-600 font-extrabold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 inline-flex items-center text-lg uppercase tracking-wider">
                Sigue a ZVA
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.727A8 8 0 016.343 5.273v14.454z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 100-18 9 9 0 000 18z" />
                </svg>
            </a>
            
            <p class="text-xs text-gray-500 mt-4">&copy; 2024 Proyecto Fisioterapia JapÃ³n</p>
        </div>
    </footer>

    <script>
        // --- 1. DATOS DE APLICACIÃ“N ---
        
        /**
         * Diccionario principal EXPANDIDO para la traducciÃ³n de todas las palabras/segmentos
         * al pasar el ratÃ³n. Las frases mÃ¡s largas deben estar primero para la coincidencia de regex.
         */
        const wordDictionary = {
            // Frases largas primero
            "ãŠç–²ã‚Œæ§˜ã§ã—ãŸ": { es: "Gracias por su esfuerzo (saludo al terminar el trabajo)", hiragana: "ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸ", kanji: "ãŠç–²ã‚Œæ§˜ã§ã—ãŸ" },
            "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™": { es: "Buenos dÃ­as (formal)", hiragana: "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™", kanji: "å¾¡åº§ã„ã¾ã™" }, 
            "ã©ã†ãã€ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™": { es: "Encantado de conocerle", hiragana: "ã©ã†ãã€ã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™", kanji: "ã©ã†ãã€å®œã—ããŠé¡˜ã„ã—ã¾ã™" },
            "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ": { es: "Muchas gracias (pasado, muy formal)", hiragana: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ", kanji: "æœ‰é›£ã†å¾¡åº§ã„ã¾ã—ãŸ" },
            "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™": { es: "Muchas gracias", hiragana: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", kanji: "æœ‰é›£ã†å¾¡åº§ã„ã¾ã™" },
            "ãŠåå‰ã¯ã€ä½•ã§ã™ã‹": { es: "Â¿CuÃ¡l es su nombre?", hiragana: "ãŠãªã¾ãˆã¯ã€ãªã‚“ã§ã™ã‹", kanji: "ãŠåå‰ã¯ã€ä½•ã§ã™ã‹" },
            "ãŠä»•äº‹ã¯ä½•ã§ã™ã‹": { es: "Â¿CuÃ¡l es su ocupaciÃ³n?", hiragana: "ãŠã—ã”ã¨ã¯ãªã‚“ã§ã™ã‹", kanji: "ãŠä»•äº‹ã¯ä½•ã§ã™ã‹" },
            "ã‚‚ã†å°‘ã—æŠ¼ã—ã¦": { es: "Presione un poco mÃ¡s", hiragana: "ã‚‚ã†ã™ã“ã—ãŠã—ã¦", kanji: "ã‚‚ã†å°‘ã—æŠ¼ã—ã¦" },
            "å¤•é£Ÿã«ä¸€ç·’ã«è¡Œãã¾ã›ã‚“ã‹": { es: "Â¿No vamos a cenar juntos?", hiragana: "ã‚†ã†ã—ã‚‡ãã«ã„ã£ã—ã‚‡ã«ã„ãã¾ã›ã‚“ã‹", kanji: "å¤•é£Ÿã«ä¸€ç·’ã«è¡Œãã¾ã›ã‚“ã‹" },
            "ç·Šæ€¥äº‹æ…‹ã¯çµ‚ã‚ã‚Šã¾ã—ãŸã‹": { es: "Â¿TerminÃ³ la situaciÃ³n de emergencia?", hiragana: "ãã‚“ãã‚…ã†ã˜ãŸã„ã¯ãŠã‚ã‚Šã¾ã—ãŸã‹", kanji: "ç·Šæ€¥äº‹æ…‹ã¯çµ‚ã‚ã‚Šã¾ã—ãŸã‹" },
            "ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯": { es: "Â¿CuÃ¡l es el horario de hoy?", hiragana: "ãã‚‡ã†ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯", kanji: "ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯" },
            "ç·´ç¿’ã®å‰ã«æ²»ç™‚ã—ã¾ã™ã‹": { es: "Â¿Hacemos la terapia antes de la prÃ¡ctica?", hiragana: "ã‚Œã‚“ã—ã‚…ã†ã®ã¾ãˆã«ã¡ã‚Šã‚‡ã†ã—ã¾ã™ã‹", kanji: "ç·´ç¿’ã®å‰ã«æ²»ç™‚ã—ã¾ã™ã‹" },
            "ç·´ç¿’ã®å¾Œã§ã€ãŠé¡˜ã„ã—ã¾ã™": { es: "DespuÃ©s de la prÃ¡ctica, por favor.", hiragana: "ã‚Œã‚“ã—ã‚…ã†ã®ã‚ã¨ã§ã€ãŠã­ãŒã„ã—ã¾ã™", kanji: "ç·´ç¿’ã®å¾Œã§ã€ãŠé¡˜ã„ã—ã¾ã™" },
            "æ»æŒ«ã®æ²»ç™‚ãŒå¿…è¦ã§ã™ã‹": { es: "Â¿Necesita tratamiento para el esguince?", hiragana: "ã­ã‚“ã–ã®ã¡ã‚Šã‚‡ã†ãŒã²ã¤ã‚ˆã†ã§ã™ã‹", kanji: "æ»æŒ«ã®æ²»ç™‚ãŒå¿…è¦ã§ã™ã‹" },
            "è…°ã®ç—›ã¿ã¯æ‚ªåŒ–ã—ã¦ã„ã¾ã™ã‹": { es: "Â¿Ha empeorado el dolor de espalda?", hiragana: "ã“ã—ã®ã„ãŸã¿ã¯ã‚ã£ã‹ã—ã¦ã„ã¾ã™ã‹", kanji: "è…°ã®ç—›ã¿ã¯æ‚ªåŒ–ã—ã¦ã„ã¾ã™ã‹" },
            "ã“ã®é¸æ‰‹ã¯å®‰é™ãŒå¿…è¦ã§ã™": { es: "Este atleta necesita reposo.", hiragana: "ã“ã®ã›ã‚“ã—ã‚…ã¯ã‚ã‚“ã›ã„ãŒå¿…è¦ã§ã™", kanji: "ã“ã®é¸æ‰‹ã¯å®‰é™ãŒå¿…è¦ã§ã™" },

            // Vocabulario y PartÃ­culas (para mÃ¡xima cobertura)
            "ã‚³ãƒ¼ãƒ": { es: "Entrenador/Coach", hiragana: "ã‚³ãƒ¼ãƒ", kanji: "N/A" },
            "ã‚¹ã‚¿ãƒƒãƒ•": { es: "Staff/Personal", hiragana: "ã‚¹ã‚¿ãƒƒãƒ•", kanji: "N/A" },
            "é¸æ‰‹": { es: "Atleta/Jugador", hiragana: "ã›ã‚“ã—ã‚…", kanji: "é¸æ‰‹" },
            "ãƒ™ãƒã‚ºã‚¨ãƒ©": { es: "Venezuela", hiragana: "ãƒ™ãƒã‚ºã‚¨ãƒ©", kanji: "N/A" },
            "å…ˆç”Ÿ": { es: "Doctor/Profesor (tÃ­tulo de respeto)", hiragana: "ã›ã‚“ã›ã„", kanji: "å…ˆç”Ÿ" },
            "ã™ã¿ã¾ã›ã‚“": { es: "Disculpe", hiragana: "ã™ã¿ã¾ã›ã‚“", kanji: "N/A" },
            "ç§ã¯": { es: "Yo soy", hiragana: "ã‚ãŸã—ã¯", kanji: "ç§ã¯" },
            "ç†å­¦ç™‚æ³•å£«": { es: "Fisioterapeuta", hiragana: "ã‚ŠãŒãã‚Šã‚‡ã†ã»ã†ã—", kanji: "ç†å­¦ç™‚æ³•å£«" },
            "ã§ã™": { es: "Es/Soy (formal)", hiragana: "ã§ã™", kanji: "N/A" },
            "ã¯ã„": { es: "SÃ­", hiragana: "ã¯ã„", kanji: "ã¯ã„" },
            "ãã†ã§ã™": { es: "AsÃ­ es", hiragana: "ãã†ã§ã™", kanji: "N/A" },
            "ãŠä»•äº‹": { es: "Trabajo/OcupaciÃ³n", hiragana: "ãŠã—ã”ã¨", kanji: "ãŠä»•äº‹" },
            "ä½•": { es: "Â¿QuÃ©?", hiragana: "ãªã«", kanji: "ä½•" },
            "ã©ã“": { es: "Â¿DÃ³nde?", hiragana: "ã©ã“", kanji: "ä½•å‡¦" },
            "ç—›ã„": { es: "Doloroso/Doler", hiragana: "ã„ãŸã„", kanji: "ç—›ã„" },
            "ã§ã™ã‹": { es: "Â¿Es...?", hiragana: "ã§ã™ã‹", kanji: "N/A" },
            "ã“ã“": { es: "AquÃ­", hiragana: "ã“ã“", kanji: "æ­¤å‡¦" },
            "è‚©": { es: "Hombro", hiragana: "ã‹ãŸ", kanji: "è‚©" },
            "è…°": { es: "Cintura/Espalda Baja", hiragana: "ã“ã—", kanji: "è…°" },
            "è†": { es: "Rodilla", hiragana: "ã²ã–", kanji: "è†" },
            "æ»æŒ«": { es: "Esguince", hiragana: "ã­ã‚“ã–", kanji: "æ»æŒ«" },
            "æ²»ç™‚": { es: "Tratamiento", hiragana: "ã¡ã‚Šã‚‡ã†", kanji: "æ²»ç™‚" },
            "å¿…è¦": { es: "Necesario", hiragana: "ã²ã¤ã‚ˆã†", kanji: "å¿…è¦" },
            "ã‚ã‚Šã¾ã™ã‹": { es: "Â¿Hay/Existe?", hiragana: "ã‚ã‚Šã¾ã™ã‹", kanji: "N/A" },
            "æ˜¨æ—¥": { es: "Ayer", hiragana: "ãã®ã†", kanji: "æ˜¨æ—¥" },
            "ã‹ã‚‰": { es: "Desde", hiragana: "ã‹ã‚‰", kanji: "N/A" },
            "æ‚ªåŒ–": { es: "Empeoramiento", hiragana: "ã‚ã£ã‹", kanji: "æ‚ªåŒ–" },
            "ã—ã¦ã„ã¾ã™": { es: "EstÃ¡ haciendo (progresivo)", hiragana: "ã—ã¦ã„ã¾ã™", kanji: "N/A" },
            "æŠ¼ã—ã¦": { es: "Presionar/Empujar (forma -te)", hiragana: "ãŠã—ã¦", kanji: "æŠ¼ã—ã¦" },
            "ã¿ã¦ã‚‚": { es: "Intentar/Probar", hiragana: "ã¿ã¦ã‚‚", kanji: "è¦‹ã¦ã‚‚" },
            "å¤§ä¸ˆå¤«": { es: "Todo bien/Seguro", hiragana: "ã ã„ã˜ã‚‡ã†ã¶", kanji: "å¤§ä¸ˆå¤«" },
            "ãŠé¡˜ã„ã—ã¾ã™": { es: "Por favor (solicitud)", hiragana: "ãŠã­ãŒã„ã—ã¾ã™", kanji: "ãŠé¡˜ã„ã—ã¾ã™" },
            "æ­©ãã¨": { es: "Al caminar/Si camina", hiragana: "ã‚ã‚‹ãã¨", kanji: "æ­©ãã¨" },
            "ç—›ã¿ãŒ": { es: "El dolor (sustantivo + part. sujeto)", hiragana: "ã„ãŸã¿ãŒ", kanji: "ç—›ã¿ãŒ" },
            "å¼·ã„ã§ã™": { es: "Es fuerte/intenso", hiragana: "ã¤ã‚ˆã„ã§ã™", kanji: "å¼·ã„ã§ã™" },
            "ä»Šæ—¥ã®": { es: "De hoy", hiragana: "ãã‚‡ã†ã®", kanji: "ä»Šæ—¥ã®" },
            "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«": { es: "Horario/Programa", hiragana: "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«", kanji: "N/A" },
            "ä½•æ™‚": { es: "QuÃ© hora", hiragana: "ãªã‚“ã˜", kanji: "ä½•æ™‚" },
            "å§‹ã¾ã‚Šã¾ã™ã‹": { es: "Â¿Comienza?", hiragana: "ã¯ã˜ã¾ã‚Šã¾ã™ã‹", kanji: "å§‹ã¾ã‚Šã¾ã™ã‹" },
            "åˆ†ã‹ã‚Šã¾ã™": { es: "Entiendo/SÃ©", hiragana: "ã‚ã‹ã‚Šã¾ã™", kanji: "åˆ†ã‹ã‚Šã¾ã™" },
            "ã¾ã ": { es: "TodavÃ­a/AÃºn", hiragana: "ã¾ã ", kanji: "N/A" },
            "åˆ†ã‹ã‚Šã¾ã›ã‚“": { es: "No entiendo/No sÃ©", hiragana: "ã‚ã‹ã‚Šã¾ã›ã‚“", kanji: "åˆ†ã‹ã‚Šã¾ã›ã‚“" },
            "äºˆç´„": { es: "Cita/Reserva", hiragana: "ã‚ˆã‚„ã", kanji: "äºˆç´„" },
            "å¤‰æ›´": { es: "Cambio", hiragana: "ã¸ã‚“ã“ã†", kanji: "å¤‰æ›´" },
            "ã—ãŸã„ã§ã™": { es: "Quiero hacer", hiragana: "ã—ãŸã„ã§ã™", kanji: "N/A" },
            "ã©ã†ã": { es: "Adelante/Por favor", hiragana: "ã©ã†ã", kanji: "N/A" },
            "ç€æ›¿ãˆ": { es: "Cambio de ropa", hiragana: "ããŒãˆ", kanji: "ç€æ›¿ãˆ" },
            "å ´æ‰€": { es: "Lugar", hiragana: "ã°ã—ã‚‡", kanji: "å ´æ‰€" },
            "ç·´ç¿’": { es: "PrÃ¡ctica/Entrenamiento", hiragana: "ã‚Œã‚“ã—ã‚…ã†", kanji: "ç·´ç¿’" },
            "å‰": { es: "Antes/Frente", hiragana: "ã¾ãˆ", kanji: "å‰" },
            "å¾Œ": { es: "DespuÃ©s", hiragana: "ã‚ã¨", kanji: "å¾Œ" },
            "æ•‘æ€¥è»Š": { es: "Ambulancia", hiragana: "ãã‚…ã†ãã‚…ã†ã—ã‚ƒ", kanji: "æ•‘æ€¥è»Š" },
            "å‘¼ã‚“ã§": { es: "Llamar (forma -te)", hiragana: "ã‚ˆã‚“ã§", kanji: "å‘¼ã‚“ã§" },
            "ãã ã•ã„": { es: "Por favor (pedido)", hiragana: "ãã ã•ã„", kanji: "ä¸‹ã•ã„" },
            "æ„è­˜": { es: "Conciencia/Consciente", hiragana: "ã„ã—ã", kanji: "æ„è­˜" },
            "ãªã„": { es: "No hay/Inexistente", hiragana: "ãªã„", kanji: "ç„¡ã„" },
            "ã™ãã«": { es: "Inmediatamente", hiragana: "ã™ãã«", kanji: "ç›´ãã«" },
            "ç·Šæ€¥": { es: "Emergencia", hiragana: "ãã‚“ãã‚…ã†", kanji: "ç·Šæ€¥" },
            "èª¿å­": { es: "CondiciÃ³n/Estado", hiragana: "ã¡ã‚‡ã†ã—", kanji: "èª¿å­" },
            "ã©ã†": { es: "CÃ³mo", hiragana: "ã©ã†", kanji: "N/A" },
            "ã§ã—ãŸã‹": { es: "Â¿Fue?", hiragana: "ã§ã—ãŸã‹", kanji: "N/A" },
            "è‰¯ã‹ã£ãŸã§ã™": { es: "Fue bueno", hiragana: "ã‚ˆã‹ã£ãŸã§ã™", kanji: "è‰¯ã‹ã£ãŸã§ã™" },
            "ã¾ãŸ": { es: "De nuevo/Hasta", hiragana: "ã¾ãŸ", kanji: "N/A" },
            "æ˜æ—¥": { es: "MaÃ±ana", hiragana: "ã‚ã—ãŸ", kanji: "æ˜æ—¥" },
            "ã˜ã‚ƒã‚": { es: "Bueno, entonces...", hiragana: "ã˜ã‚ƒã‚", kanji: "N/A" },
            "ä¸€ç·’ã«": { es: "Juntos", hiragana: "ã„ã£ã—ã‚‡ã«", kanji: "ä¸€ç·’ã«" },
            "å¤•é£Ÿ": { es: "Cena", hiragana: "ã‚†ã†ã—ã‚‡ã", kanji: "å¤•é£Ÿ" },
            "è¡Œãã¾ã›ã‚“ã‹": { es: "Â¿No vamos?", hiragana: "ã„ãã¾ã›ã‚“ã‹", kanji: "è¡Œãã¾ã›ã‚“ã‹" },
            "æ°´": { es: "Agua", hiragana: "ã¿ãš", kanji: "æ°´" },
            "é£²ã‚“ã§ã‚‚": { es: "Si bebo", hiragana: "ã®ã‚“ã§ã‚‚", kanji: "é£²ã‚“ã§ã‚‚" },
            "ã„ã„ã§ã™ã‹": { es: "Â¿EstÃ¡ bien?", hiragana: "ã„ã„ã§ã™ã‹", kanji: "N/A" },
            "ã¾ã£ã™ã": { es: "Recto", hiragana: "ã¾ã£ã™ã", kanji: "N/A" },
            "è¡Œã£ã¦": { es: "Ir (forma -te)", hiragana: "ã„ã£ã¦", kanji: "è¡Œã£ã¦" },
            "å·¦": { es: "Izquierda", hiragana: "ã²ã ã‚Š", kanji: "å·¦" },
            "åˆå‰": { es: "MaÃ±ana (a.m.)", hiragana: "ã”ãœã‚“", kanji: "åˆå‰" },
            "9æ™‚": { es: "Nueve en punto", hiragana: "ãã˜", kanji: "9æ™‚" },
            "ã«": { es: "PartÃ­cula de tiempo/lugar", hiragana: "ã«", kanji: "N/A" },
            "ä½“èª¿": { es: "CondiciÃ³n fÃ­sica", hiragana: "ãŸã„ã¡ã‚‡ã†", kanji: "ä½“èª¿" },
            "è‰¯ã‹ã£ãŸ": { es: "Fue bueno", hiragana: "ã‚ˆã‹ã£ãŸ", kanji: "è‰¯ã‹ã£ãŸ" },
            "ã„ã„ã§ã™ã­": { es: "Me parece bien", hiragana: "ã„ã„ã§ã™ã­", kanji: "N/A" },
            "ãœã²": { es: "Absolutamente/Con gusto", hiragana: "ãœã²", kanji: "æ˜¯é" },
            "äº‹æ…‹": { es: "SituaciÃ³n", hiragana: "ã˜ãŸã„", kanji: "äº‹æ…‹" },
            "çµ‚ã‚ã‚Šã¾ã—ãŸã‹": { es: "Â¿TerminÃ³?", hiragana: "ãŠã‚ã‚Šã¾ã—ãŸã‹", kanji: "çµ‚ã‚ã‚Šã¾ã—ãŸã‹" },
            "ä»Š": { es: "Ahora", hiragana: "ã„ã¾", kanji: "ä»Š" },
            "ã“ã®": { es: "Este/a", hiragana: "ã“ã®", kanji: "N/A" },
            "å®‰é™": { es: "Reposo", hiragana: "ã‚ã‚“ã›ã„", kanji: "å®‰é™" },
            "ã«ã•ã›ã¾ã™": { es: "Le harÃ© (causativo)", hiragana: "ã«ã•ã›ã¾ã™", kanji: "ã«ã•ã›ã¾ã™" },
            "ã§ãã¾ã›ã‚“": { es: "No puede (hacer)", hiragana: "ã§ãã¾ã›ã‚“", kanji: "å‡ºæ¥ã¾ã›ã‚“" },
            "èª°ã‹": { es: "Alguien", hiragana: "ã ã‚Œã‹", kanji: "èª°ã‹" },
            "åŠ©ã‘": { es: "Ayuda", hiragana: "ãŸã™ã‘", kanji: "åŠ©ã‘" },
            "ç§ãŒ": { es: "Yo (sujeto)", hiragana: "ã‚ãŸã—ãŒ", kanji: "ç§ãŒ" },
            "æ‰‹ä¼ã„ã¾ã™": { es: "AyudarÃ©", hiragana: "ã¦ã¤ã ã„ã¾ã™", kanji: "æ‰‹ä¼ã„ã¾ã™" },
            "ã¨ã“ã‚": { es: "Lugar", hiragana: "ã¨ã“ã‚", kanji: "æ‰€" },
            "æŒ‡ã—ã¦": { es: "SeÃ±alar (forma -te)", hiragana: "ã•ã—ã¦", kanji: "æŒ‡ã—ã¦" },
            "ç—›ã¿": { es: "Dolor (sustantivo)", hiragana: "ã„ãŸã¿", kanji: "ç—›ã¿" },
            "æ²»ç™‚ã¯": { es: "El tratamiento (tema)", hiragana: "ã¡ã‚Šã‚‡ã†ã¯", kanji: "æ²»ç™‚ã¯" },
            "çµ‚ã‚ã‚Š": { es: "Fin", hiragana: "ãŠã‚ã‚Š", kanji: "çµ‚ã‚ã‚Š" },
            
            // PartÃ­culas BÃ¡sicas (para asegurar cobertura total de caracteres)
            "ã¯": { es: "PartÃ­cula de tema", hiragana: "ã¯", kanji: "ã¯" },
            "ãŒ": { es: "PartÃ­cula de sujeto", hiragana: "ãŒ", kanji: "ãŒ" },
            "ã‚’": { es: "PartÃ­cula de objeto directo", hiragana: "ã‚’", kanji: "ã‚’" },
            "ã®": { es: "PartÃ­cula posesiva/de", hiragana: "ã®", kanji: "ã®" },
            "ã¨": { es: "PartÃ­cula 'con'/y", hiragana: "ã¨", kanji: "ã¨" },
            "ã§": { es: "PartÃ­cula de lugar/medio", hiragana: "ã§", kanji: "ã§" },
            "ã‚‚": { es: "PartÃ­cula 'tambiÃ©n'", hiragana: "ã‚‚", kanji: "ã‚‚" },
            "ã¸": { es: "PartÃ­cula de direcciÃ³n", hiragana: "ã¸", kanji: "ã¸" },
            "ã«": { es: "PartÃ­cula de tiempo/lugar", hiragana: "ã«", kanji: "ã«" },

        };

        const dialogues = [
            // --- Bloque A: Saludos y Presentaciones (FÃ¡cil) ---
            { level: 'Facil', title: "DiÃ¡logo 1: PresentaciÃ³n (Fisioterapeuta)", lines: [
                { role: 'Staff', jp: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚ãŠåå‰ã¯ã€ä½•ã§ã™ã‹ï¼Ÿ', romaji: 'OhayÅ gozaimasu. O-namae wa, nan desu ka?', es: 'Buenos dÃ­as. Â¿CuÃ¡l es su nombre?' },
                { role: 'PT', jp: 'ç§ã¯ãƒãƒŒã‚¨ãƒ«ã€ç†å­¦ç™‚æ³•å£«ã§ã™ã€‚', romaji: 'Watashi wa Manueru, rigaku ryÅhÅshi desu.', es: 'Yo soy Manuel, el fisioterapeuta.' },
                { role: 'Staff', jp: 'ã©ã†ãã€ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚', romaji: 'DÅzo, yoroshiku onegaishimasu.', es: 'Encantado de conocerle (literalmente: por favor, trÃ¡tame bien).' },
            ]},
            { level: 'Facil', title: "DiÃ¡logo 2: IdentificaciÃ³n de Rol", lines: [
                { role: 'Athlete', jp: 'ã™ã¿ã¾ã›ã‚“ã€ãŠä»•äº‹ã¯ä½•ã§ã™ã‹ï¼Ÿ', romaji: 'Sumimasen, o-shigoto wa nan desu ka?', es: 'Disculpe, Â¿cuÃ¡l es su trabajo?' },
                { role: 'PT', jp: 'ç§ã¯ãƒ™ãƒã‚ºã‚¨ãƒ©ã®ç†å­¦ç™‚æ³•å£«ã§ã™ã€‚', romaji: 'Watashi wa Benezuera no rigaku ryÅhÅshi desu.', es: 'Yo soy el fisioterapeuta de Venezuela.' },
                { role: 'Athlete', jp: 'ã¯ã„ã€åˆ†ã‹ã‚Šã¾ã™ã€‚', romaji: 'Hai, wakarimasu.', es: 'SÃ­, lo entiendo.' },
            ]},
            { level: 'Facil', title: "DiÃ¡logo 3: Saludo al Entrenador", lines: [
                { role: 'PT', jp: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€ã‚³ãƒ¼ãƒã€‚', romaji: 'OhayÅ gozaimasu, kÅchi.', es: 'Buenos dÃ­as, entrenador.' },
                { role: 'Coach', jp: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€å…ˆç”Ÿã€‚ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ï¼Ÿ', romaji: 'OhayÅ gozaimasu, sensei. KyÅ no sukejÅ«ru wa?', es: 'Buenos dÃ­as, Doctor. Â¿CuÃ¡l es el horario de hoy?' },
            ]},
            { level: 'Facil', title: "DiÃ¡logo 4: Pidiendo Disculpas/Permiso", lines: [
                { role: 'PT', jp: 'ã™ã¿ã¾ã›ã‚“ã€æ°´ã‚’é£²ã‚“ã§ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', romaji: 'Sumimasen, mizu o nonde mo ii desu ka?', es: 'Disculpe, Â¿puedo beber agua?' },
                { role: 'Staff', jp: 'ã¯ã„ã€ã©ã†ãã€‚', romaji: 'Hai, dÅzo.', es: 'SÃ­, adelante.' },
            ]},
            
            // --- Bloque B: AnatomÃ­a y EvaluaciÃ³n de Dolor (Medio) ---
            { level: 'Medio', title: "DiÃ¡logo 5: Dolor de Rodilla", lines: [
                { role: 'PT', jp: 'ã“ã‚“ã«ã¡ã¯ã€ã©ã“ãŒç—›ã„ã§ã™ã‹ï¼Ÿ', romaji: 'Konnichiwa, doko ga itai desu ka?', es: 'Hola, Â¿dÃ³nde le duele?' },
                { role: 'Athlete', jp: 'è†ãŒç—›ã„ã§ã™ã€‚æ­©ãã¨ç—›ã¿ãŒå¼·ã„ã§ã™ã€‚', romaji: 'Hiza ga itai desu. Aruku to itami ga tsuyoi desu.', es: 'Me duele la rodilla. Cuando camino, el dolor es intenso.' },
                { role: 'PT', jp: 'å°‘ã—æŠ¼ã—ã¦ã¿ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ', romaji: 'Sukoshi oshitemite mo daijÅbu desu ka?', es: 'Â¿EstÃ¡ bien si presiono un poco?' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 6: Problema en el Hombro", lines: [
                { role: 'Athlete', jp: 'å…ˆç”Ÿã€è‚©ã®èª¿å­ãŒè‰¯ããªã„ã§ã™ã€‚', romaji: 'Sensei, kata no chÅshi ga yoku nai desu.', es: 'Doctor, la condiciÃ³n de mi hombro no es buena.' },
                { role: 'PT', jp: 'ã„ã¤ã‹ã‚‰ç—›ã„ã§ã™ã‹ï¼Ÿ', romaji: 'Itsu kara itai desu ka?', es: 'Â¿Desde cuÃ¡ndo le duele?' },
                { role: 'Athlete', jp: 'æ˜¨æ—¥ã‹ã‚‰ã§ã™ã€‚', romaji: 'KinÅ kara desu.', es: 'Desde ayer.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 7: Esguince", lines: [
                { role: 'PT', jp: 'æ»æŒ«ã®æ²»ç™‚ãŒå¿…è¦ã§ã™ã‹ï¼Ÿ', romaji: 'Nenza no chiryÅ ga hitsuyÅ desu ka?', es: 'Â¿Necesita tratamiento para el esguince?' },
                { role: 'Athlete', jp: 'ã¯ã„ã€ãŠé¡˜ã„ã—ã¾ã™ã€‚', romaji: 'Hai, onegai shimasu.', es: 'SÃ­, por favor.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 8: EvaluaciÃ³n de Dolor (Espalda)", lines: [
                { role: 'PT', jp: 'è…°ã®ç—›ã¿ã¯æ‚ªåŒ–ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ', romaji: 'Koshi no itami wa akka shite imasu ka?', es: 'Â¿Ha empeorado el dolor de la espalda baja?' },
                { role: 'Athlete', jp: 'ã„ã„ãˆã€å¤§ä¸ˆå¤«ã§ã™ã€‚', romaji: 'Iie, daijÅbu desu.', es: 'No, estoy bien.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 9: DÃ³nde duele exactamente", lines: [
                { role: 'PT', jp: 'ç—›ã„ã¨ã“ã‚ã‚’æŒ‡ã—ã¦ãã ã•ã„ã€‚', romaji: 'Itai tokoro o yubishite kudasai.', es: 'Por favor, seÃ±ale dÃ³nde le duele.' },
                { role: 'Athlete', jp: 'ã“ã“ã§ã™ã€‚', romaji: 'Koko desu.', es: 'Es aquÃ­.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 10: Fin de la SesiÃ³n", lines: [
                { role: 'PT', jp: 'ä»Šæ—¥ã®æ²»ç™‚ã¯çµ‚ã‚ã‚Šã§ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚', romaji: 'KyÅ no chiryÅ wa owari desu. Otsukare sama deshita.', es: 'El tratamiento de hoy ha terminado. Gracias por su esfuerzo.' },
                { role: 'Athlete', jp: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚', romaji: 'ArigatÅ gozaimasu.', es: 'Muchas gracias.' },
            ]},

            // --- Bloque C: Rutinas, Citas y Staff (Medio) ---
            { level: 'Medio', title: "DiÃ¡logo 11: Preguntar por Horario", lines: [
                { role: 'PT', jp: 'ä»Šæ—¥ã®ç·´ç¿’ã¯ä½•æ™‚ã«å§‹ã¾ã‚Šã¾ã™ã‹ï¼Ÿ', romaji: 'KyÅ no renshÅ« wa nanji ni hajimarimasu ka?', es: 'Â¿A quÃ© hora empieza la prÃ¡ctica de hoy?' },
                { role: 'Coach', jp: 'åˆå‰9æ™‚ã«å§‹ã¾ã‚Šã¾ã™ã€‚', romaji: 'Gozen ku-ji ni hajimarimasu.', es: 'Empieza a las 9 de la maÃ±ana.' },
                { role: 'PT', jp: 'åˆ†ã‹ã‚Šã¾ã™ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚', romaji: 'Wakarimasu, arigatÅ gozaimasu.', es: 'Entendido, muchas gracias.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 12: Cambio de Cita", lines: [
                { role: 'Staff', jp: 'ç†å­¦ç™‚æ³•ã®äºˆç´„ã‚’å¤‰æ›´ã—ãŸã„ã§ã™ã€‚', romaji: 'Rigaku ryÅhÅ no yoyaku o henkÅ shitai desu.', es: 'Quiero cambiar la cita de fisioterapia.' },
                { role: 'PT', jp: 'ã¯ã„ã€ä½•æ™‚ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ', romaji: 'Hai, nanji ni henkÅ shimasu ka?', es: 'SÃ­, Â¿a quÃ© hora le gustarÃ­a cambiarla?' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 13: UbicaciÃ³n del Vestuario", lines: [
                { role: 'Athlete', jp: 'ç€æ›¿ãˆã®å ´æ‰€ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', romaji: 'Kigae no basho wa doko desu ka?', es: 'Â¿DÃ³nde estÃ¡ el lugar para cambiarse?' },
                { role: 'PT', jp: 'ã“ã“ã‚’ã¾ã£ã™ãè¡Œã£ã¦ã€å·¦ã§ã™ã€‚', romaji: 'Koko o massugu itte, hidari desu.', es: 'Vaya recto por aquÃ­ y estÃ¡ a la izquierda.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 14: PrÃ¡ctica Antes o DespuÃ©s", lines: [
                { role: 'Coach', jp: 'ç·´ç¿’ã®å‰ã«æ²»ç™‚ã—ã¾ã™ã‹ï¼Ÿå¾Œã«ã—ã¾ã™ã‹ï¼Ÿ', romaji: 'RenshÅ« no mae ni chiryÅ shimasu ka? Ato ni shimasu ka?', es: 'Â¿Hacemos el tratamiento antes de la prÃ¡ctica o despuÃ©s?' },
                { role: 'PT', jp: 'ç·´ç¿’ã®å¾Œã§ã€ãŠé¡˜ã„ã—ã¾ã™ã€‚', romaji: 'RenshÅ« no ato de, onegai shimasu.', es: 'DespuÃ©s de la prÃ¡ctica, por favor.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 15: Revisando la CondiciÃ³n Diaria", lines: [
                { role: 'PT', jp: 'ä»Šæ—¥ã®ä½“èª¿ã¯ã©ã†ã§ã—ãŸã‹ï¼Ÿ', romaji: 'KyÅ no taichÅ wa dÅ deshita ka?', es: 'Â¿CÃ³mo estuvo su condiciÃ³n fÃ­sica hoy?' },
                { role: 'Athlete', jp: 'è‰¯ã‹ã£ãŸã§ã™ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚', romaji: 'Yokatta desu. ArigatÅ gozaimasu.', es: 'Fue buena. Muchas gracias.' },
            ]},
            { level: 'Medio', title: "DiÃ¡logo 16: InvitaciÃ³n Informal", lines: [
                { role: 'PT', jp: 'ã˜ã‚ƒã‚ã€ã¾ãŸæ˜æ—¥ï¼å¤•é£Ÿã«ä¸€ç·’ã«è¡Œãã¾ã›ã‚“ã‹ï¼Ÿ', romaji: 'JÄ, mata ashita! YÅ«shoku ni issho ni ikimasen ka?', es: 'Bueno, Â¡hasta maÃ±ana! Â¿No vamos a cenar juntos?' },
                { role: 'Staff', jp: 'ã„ã„ã§ã™ã­ï¼ãœã²ã€‚', romaji: 'Ii desu ne! Zehi.', es: 'Â¡Me parece bien! Absolutamente.' },
            ]},

            // --- Bloque D: Emergencias y Asistencia CrÃ­tica (DifÃ­cil) ---
            { level: 'Dificil', title: "DiÃ¡logo 17: Pidiendo Ambulancia", lines: [
                { role: 'Coach', jp: 'ç·Šæ€¥ã§ã™ï¼æ•‘æ€¥è»Šã‚’å‘¼ã‚“ã§ãã ã•ã„ï¼', romaji: 'KinkyÅ« desu! KyÅ«kyÅ«sha o yonde kudasai!', es: 'Â¡Es una emergencia! Â¡Por favor, llame a una ambulancia!' },
                { role: 'PT', jp: 'åˆ†ã‹ã‚Šã¾ã™ã€‚ã™ãã«ã€‚', romaji: 'Wakarimasu. Sugu ni.', es: 'Entendido. Inmediatamente.' },
            ]},
            { level: 'Dificil', title: "DiÃ¡logo 18: PÃ©rdida de Conciencia", lines: [
                { role: 'PT', jp: 'æ„è­˜ãŒãªã„ã§ã™ã€‚èª°ã‹åŠ©ã‘ãŒå¿…è¦ã§ã™ã€‚', romaji: 'Ishiki ga nai desu. Dareka tasuke ga hitsuyÅ desu.', es: 'EstÃ¡ inconsciente. Se necesita ayuda de alguien.' },
                { role: 'Staff', jp: 'ç§ãŒæ‰‹ä¼ã„ã¾ã™ã€‚', romaji: 'Watashi ga tetsudaimasu.', es: 'Yo ayudarÃ©.' },
            ]},
            { level: 'Dificil', title: "DiÃ¡logo 19: Necesidad de Reposo Absoluto", lines: [
                { role: 'PT', jp: 'ã“ã®é¸æ‰‹ã¯å®‰é™ãŒå¿…è¦ã§ã™ã€‚ç·´ç¿’ã¯ã§ãã¾ã›ã‚“ã€‚', romaji: 'Kono senshu wa ansei ga hitsuyÅ desu. RenshÅ« wa dekimasen.', es: 'Este atleta necesita reposo. No puede entrenar.' },
                { role: 'Coach', jp: 'åˆ†ã‹ã‚Šã¾ã™ã€‚å®‰é™ã«ã•ã›ã¾ã™ã€‚', romaji: 'Wakarimasu. Ansei ni sasemasu.', es: 'Entendido. Le harÃ© guardar reposo.' },
            ]},
            { level: 'Dificil', title: "DiÃ¡logo 20: Confirmando la Emergencia", lines: [
                { role: 'Staff', jp: 'ç·Šæ€¥äº‹æ…‹ã¯çµ‚ã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ', romaji: 'KinkyÅ« jitai wa owarimashita ka?', es: 'Â¿TerminÃ³ la situaciÃ³n de emergencia?' },
                { role: 'PT', jp: 'ã¯ã„ã€ä»Šã¯å¤§ä¸ˆå¤«ã§ã™ã€‚', romaji: 'Hai, ima wa daijÅbu desu.', es: 'SÃ­, por ahora estÃ¡ bien.' },
            ]},
        ];

        // Bloques TemÃ¡ticos para el Sidenav (20 DiÃ¡logos agrupados)
        const dialogueBlocks = [
            { title: "Bloque 1: Saludos y Presentaciones (1-4)", range: [0, 3], level: 'Facil' },
            { title: "Bloque 2: AnatomÃ­a y EvaluaciÃ³n de Dolor (5-10)", range: [4, 9], level: 'Medio' },
            { title: "Bloque 3: Rutinas, Citas y Staff (11-16)", range: [10, 15], level: 'Medio' },
            { title: "Bloque 4: Emergencias y Asistencia CrÃ­tica (17-20)", range: [16, 19], level: 'Dificil' },
        ];


        let currentDialogIndex = 0;
        let currentLineIndex = -1; // -1 para empezar en el primer paso del diÃ¡logo.
        let currentDifficulty = 'medium'; // Estado inicial: Medio (JP + ES)

        // --- 2. ELEMENTOS DEL DOM ---
        const app = document.getElementById('app');
        const dialogTitle = document.getElementById('dialog-title');
        const levelDisplay = document.getElementById('levelDisplay');
        const conversationLog = document.getElementById('conversation-log');
        const nextLineBtn = document.getElementById('next-line-btn');
        const resetDialogBtn = document.getElementById('reset-dialog-btn');
        const statusMessage = document.getElementById('status-message');
        const difficultySelector = document.getElementById('difficulty-selector');
        
        // Elementos Sidenav
        const sidenav = document.getElementById('sidenav');
        const sidenavContent = document.getElementById('sidenav-content');
        const openSidenavBtn = document.getElementById('open-sidenav-btn');
        const closeSidenavBtn = document.getElementById('close-sidenav-btn');
        const mainContent = document.getElementById('main-content');
        const initialMessage = document.getElementById('initial-message');
        
        // Elementos Footer
        const typewriterTextElement = document.getElementById('typewriter-text');
        
        // --- 3. FUNCIONES DE LÃ“GICA DE LA APP ---
        
        /**
         * Aplica la clase CSS de color y texto segÃºn el nivel de dificultad del diÃ¡logo.
         */
        function changeLevelStyle(level) {
            const colorMap = {
                'Facil': { colorClass: 'facil-color', textClass: 'facil-text', text: 'Nivel: FÃ¡cil' },
                'Medio': { colorClass: 'medio-color', textClass: 'medio-text', text: 'Nivel: Medio' },
                'Dificil': { colorClass: 'dificil-color', textClass: 'dificil-text', text: 'Nivel: DifÃ­cil' },
            };

            const data = colorMap[level] || colorMap['Facil'];
            
            // Limpiar clases
            app.classList.remove('facil-color', 'medio-color', 'dificil-color');
            levelDisplay.classList.remove('facil-color', 'medio-color', 'dificil-color', 'facil-text', 'medio-text', 'dificil-text');
            
            // Aplicar nuevas clases
            app.classList.add(data.colorClass);
            levelDisplay.classList.add(data.colorClass, data.textClass);
            levelDisplay.textContent = data.text;
        }

        /**
         * Inicializa o reinicia un diÃ¡logo especÃ­fico.
         */
        function loadDialog(index) {
            currentDialogIndex = index;
            currentLineIndex = -1;
            conversationLog.innerHTML = '';
            
            const dialog = dialogues[currentDialogIndex];
            dialogTitle.textContent = dialog.title;
            
            // Aplicar color de nivel
            changeLevelStyle(dialog.level);
            
            if (initialMessage) initialMessage.style.display = 'none';
            nextLineBtn.disabled = false;
            
            updateControls();
            applyDifficulty(currentDifficulty, true); // Aplicar dificultad al cargar
        }
        
        /**
         * Muestra la siguiente lÃ­nea del diÃ¡logo con la animaciÃ³n de manga.
         */
        function displayNextLine() {
            const dialog = dialogues[currentDialogIndex];
            currentLineIndex++;

            if (currentLineIndex < dialog.lines.length) {
                const line = dialog.lines[currentLineIndex];
                renderLine(line);
            }
            updateControls();
        }

        /**
         * Renderiza una lÃ­nea individual del diÃ¡logo.
         */
        function renderLine(line) {
            const isPT = line.role === 'PT' || line.speaker === 'A';
            
            const alignClass = isPT ? 'justify-start' : 'justify-end';
            const bubbleClass = isPT 
                ? 'bg-blue-100 text-gray-800 border-blue-400' 
                : 'bg-white text-gray-800 border-gray-300';
            const roleColor = isPT ? 'text-blue-600' : 'text-green-600';
            
            // Aplicar visibilidad inicial basada en la dificultad actual
            let romajiClass = currentDifficulty === 'medium' || currentDifficulty === 'hard' ? 'hidden' : '';
            let esClass = currentDifficulty === 'hard' ? 'hidden' : '';

            const speakerLabel = line.role || line.speaker;

            const wordHTML = makeHoverable(line.jp);

            const messageElement = document.createElement('div');
            messageElement.className = `flex ${alignClass} manga-bubble-animated`;
            messageElement.innerHTML = `
                <div class="max-w-xs md:max-w-lg p-3 rounded-xl border-2 ${bubbleClass} shadow-md">
                    <p class="font-bold ${roleColor} text-sm mb-1">${speakerLabel}</p>
                    <p class="japanese-text text-xl font-semibold mb-1" style="font-family: 'Noto Sans JP', sans-serif;">${wordHTML}</p>
                    <p class="text-sm text-gray-600 mb-1 italic line-romaji ${romajiClass}">${line.romaji}</p>
                    <p class="text-sm text-gray-700 font-medium line-es ${esClass}">${line.es}</p>
                </div>
            `;
            
            conversationLog.appendChild(messageElement);
            conversationLog.scrollTop = conversationLog.scrollHeight;
        }
        
        /**
         * Actualiza el texto y estado de los botones.
         */
        function updateControls() {
            const totalLines = dialogues[currentDialogIndex].lines.length;
            const dialogNum = currentDialogIndex + 1;
            const totalDialogs = dialogues.length;

            if (currentLineIndex < totalLines - 1) {
                nextLineBtn.textContent = `Siguiente LÃ­nea (${currentLineIndex + 2}/${totalLines})`;
                nextLineBtn.disabled = false;
                statusMessage.textContent = `Practicando DiÃ¡logo ${dialogNum} de ${totalDialogs}.`;
            } else {
                nextLineBtn.textContent = `DiÃ¡logo Completo`;
                nextLineBtn.disabled = true;
                statusMessage.textContent = `âœ… DiÃ¡logo completado (${dialogNum}/${totalDialogs}). Usa el menÃº para seguir practicando.`;
            }
        }
        
        /**
         * Controla la visibilidad de Romaji/EspaÃ±ol en las lÃ­neas ya mostradas.
         */
        function applyDifficulty(difficulty, forceRedraw = false) {
            currentDifficulty = difficulty;
            const logItems = conversationLog.querySelectorAll('.line-romaji, .line-es');

            logItems.forEach(element => {
                element.classList.remove('hidden');

                if (element.classList.contains('line-romaji') && (difficulty === 'medium' || difficulty === 'hard')) {
                    element.classList.add('hidden');
                }
                if (element.classList.contains('line-es') && difficulty === 'hard') {
                    element.classList.add('hidden');
                }
            });
            
            if (forceRedraw) {
                // Si forzamos el redibujo (al cambiar de diÃ¡logo), aseguramos que la dificultad estÃ© aplicada.
                updateControls();
            }
        }
        
        // --- 4. FUNCIONES DE SIDENAV (MENÃš LATERAL) ---
        
        function openSidenav() {
            sidenav.classList.add('open');
            mainContent.classList.add('blurry');
            document.body.style.overflow = 'hidden'; // Evita el scroll del fondo
        }

        function closeSidenav() {
            sidenav.classList.remove('open');
            mainContent.classList.remove('blurry');
            document.body.style.overflow = 'auto';
        }
        
        /**
         * Rellena el menÃº lateral con opciones de diÃ¡logo agrupadas.
         */
        function populateSidenav() {
            sidenavContent.innerHTML = ''; 

            dialogueBlocks.forEach(block => {
                const blockTitle = document.createElement('h4');
                blockTitle.className = 'font-bold text-lg text-blue-800 mt-4 mb-2 border-b-2 border-blue-200 pb-1';
                blockTitle.textContent = block.title;
                sidenavContent.appendChild(blockTitle);
                
                for (let i = block.range[0]; i <= block.range[1]; i++) {
                    if (i < dialogues.length) {
                        const dialog = dialogues[i];
                        const dialogLink = document.createElement('div');
                        dialogLink.className = `sidenav-item p-3 rounded-lg cursor-pointer transition duration-150 text-gray-700 hover:bg-blue-100 hover:text-blue-700`;
                        dialogLink.innerHTML = `<span class="font-semibold">D${i + 1}:</span> ${dialog.title.split(': ')[1]} <span class="${dialog.level.toLowerCase()}-text text-xs italic ml-2">(${dialog.level})</span>`;
                        dialogLink.dataset.index = i;
                        
                        dialogLink.addEventListener('click', () => {
                            loadDialog(i);
                            closeSidenav();
                        });
                        
                        sidenavContent.appendChild(dialogLink);
                    }
                }
            });
        }
        
        // --- 5. FUNCIONES DE TOOLTIP (HOVER) ---

        function showTooltip(element, data) {
            const content = document.getElementById('tooltip-content');
            
            content.innerHTML = `
                <div class="font-bold text-lg mb-1">${data.es}</div>
                <div class="text-xs border-t border-gray-600 pt-1 mt-1">
                    <span class="font-bold text-yellow-300">ã²ã‚‰ãŒãª/ã‚«ã‚¿ã‚«ãƒŠ:</span> ${data.hiragana}
                </div>
                <div class="text-xs">
                    <span class="font-bold text-red-300">æ¼¢å­—/Original:</span> ${data.kanji || 'N/A'}
                </div>
            `;

            // Obtener la posiciÃ³n de la palabra
            const rect = element.getBoundingClientRect();
            
            // Calcular la posiciÃ³n del tooltip (encima y centrado)
            const tooltipWidth = 180; // EstimaciÃ³n
            const tooltipHeight = 100; // EstimaciÃ³n
            
            let x = rect.left + rect.width / 2 - tooltipWidth / 2;
            let y = rect.top - tooltipHeight - 15; // 15px de margen
            
            // Ajuste de lÃ­mites (para que no se salga de la pantalla)
            if (x < 10) x = 10;
            if (x + tooltipWidth > window.innerWidth - 10) x = window.innerWidth - tooltipWidth - 10;
            if (y < 10) y = rect.bottom + 10; // Si no cabe arriba, lo pone abajo
            
            tooltip.style.width = `${tooltipWidth}px`;
            tooltip.style.left = `${x}px`;
            tooltip.style.top = `${y}px`;
            
            tooltip.classList.add('visible');
        }

        function hideTooltip() {
            tooltip.classList.remove('visible');
        }

        /**
         * Divide el texto japonÃ©s en palabras interactivas (spans) para el hover.
         * Esta funciÃ³n se basa en que el wordDictionary contiene TODOS los segmentos.
         */
        function makeHoverable(japaneseText) {
            // Unir el vocabulario del diccionario para crear una RegEx. Las frases mÃ¡s largas deben ir primero.
            const keys = Object.keys(wordDictionary).sort((a, b) => b.length - a.length);
            
            // ExpresiÃ³n regular para encontrar las palabras en el diccionario
            // El regex usa alternancia (|) con las claves ordenadas por longitud (mÃ¡s largas primero)
            const regex = new RegExp(`(${keys.join('|')})`, 'g');
            
            const html = japaneseText.replace(regex, (match) => {
                const data = wordDictionary[match];
                if (data) {
                    // Si encuentra una coincidencia en el diccionario, la envuelve con el span interactivo
                    const dataString = JSON.stringify(data).replace(/"/g, '&quot;');
                    return `<span class="japanese-word" 
                                onmouseover="showTooltip(this, ${dataString})" 
                                onmouseout="hideTooltip()">
                                ${match}
                            </span>`;
                }
                // Si por alguna razÃ³n el regex coincide pero no estÃ¡ en el diccionario (no deberÃ­a pasar), 
                // devuelve el match sin envolver.
                return match; 
            });

            return html;
        }
        
        // --- 6. FUNCIÃ“N DE ANIMACIÃ“N DE MÃQUINA DE ESCRIBIR EN EL FOOTER ---
        
        const footerPhrases = [
            { text: "å­¦ã¼ã†ã€‚", lang: "JaponÃ©s" }, // ManabÅ (Let's learn/a aprender)
            { text: "Lernen wir.", lang: "AlemÃ¡n" },
            { text: "Let's learn.", lang: "InglÃ©s" }
        ];

        function startTypewriterAnimation() {
            let phraseIndex = 0;
            const element = typewriterTextElement;

            function runAnimation() {
                const currentPhrase = footerPhrases[phraseIndex % footerPhrases.length].text;
                
                // 1. Limpiar y establecer nuevo texto
                element.classList.remove('typewriter-text-container');
                element.textContent = currentPhrase; 

                // 2. Forzar un reflow (para reiniciar la animaciÃ³n CSS)
                void element.offsetWidth; 

                // 3. Aplicar la clase de animaciÃ³n
                element.classList.add('typewriter-text-container');
                
                phraseIndex++;
            }

            // Iniciar la animaciÃ³n y repetirla cada 5 segundos
            runAnimation(); 
            setInterval(runAnimation, 5000); 
        }

        // --- 7. EVENT LISTENERS E INICIALIZACIÃ“N ---

        // Controladores de DiÃ¡logo
        nextLineBtn.addEventListener('click', displayNextLine);
        resetDialogBtn.addEventListener('click', () => loadDialog(currentDialogIndex));

        // Controladores Sidenav
        openSidenavBtn.addEventListener('click', openSidenav);
        closeSidenavBtn.addEventListener('click', closeSidenav);

        // Manejar cambio de dificultad
        difficultySelector.addEventListener('change', (event) => {
            currentDifficulty = event.target.value;
            // Re-aplicar la dificultad a las lÃ­neas ya mostradas
            applyDifficulty(currentDifficulty);
        });
        
        // Exportar funciones globales (necesarias para los eventos inline de onmouseover)
        window.showTooltip = showTooltip;
        window.hideTooltip = hideTooltip;

        // InicializaciÃ³n
        window.onload = () => {
            populateSidenav();
            startTypewriterAnimation();
            
            // Inicializar el estado del botÃ³n
            nextLineBtn.textContent = 'Siguiente LÃ­nea';
            nextLineBtn.disabled = true;
        };

    </script>
</body>
</html>
